<!DOCTYPE html>
<html>
<head>
    <title>Interactive Calendar</title>
    <!-- FullCalendar CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css">
    <!-- FullCalendar JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- manage AJAX requests -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <!-- manage calendar events -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js"></script>
    <link rel="stylesheet" type="text/css" href="trycal.css">
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <img src="images/logo.png" alt="Logo">
            </div>
            <nav class="menu">
                <div class="dropdown">
                    <a href="calendar.html" class="active">Events</a>
                    <ul class="dropdown-menu">
                        <li><a href="manageAddon.php" class="active3">Manage Add-Ons</a></li>
                    </ul>
                </div>
                <div class="dropdown">
                    <a href="supplierM.html">Suppliers</a>
                    <ul class="dropdown-menu">
                        <li><a href="manageFood.php" class="active3">Manage Food</a></li>
                        <li><a href="manageMerchandise.php" class="active3">Manage Merchandise</a></li>
                        <li><a href="manageFoodSup.php" class="active3">Manage Food Supplier</a></li>
                        <li><a href="manageMerchan.php" class="active3">Manage Merchandise Supplier</a></li>
                        <li><a href="manageInventory.php" class="active3">Manage Inventory</a></li>
                    </ul>
                </div>
                <div class="dropdown">
                    <a href="financeM.html">Finance</a>
                    <ul class="dropdown-menu">
                        <li><a href="managePayments.php" class="active3">View Payments</a></li>
                        <li><a href="manageExpense.php" class="active3">View Expenses</a></li>
                        <li><a href="expensereport.html" class="active3">Expense & Income Chart and Report</a></li>
                        <li><a href="expenseReports.php" class="active3">Expense Report</a></li>
                        <li><a href="incomeReport.php" class="active3">Income Report</a></li>
                    </ul>
                </div>
                <div class="dropdown">
                    <a href="staffM.html">Staff</a>
                    <ul class="dropdown-menu">
                        <li><a href="manageStaff.php" class="active3">Manage Staff</a></li>
                        <li><a href="manageTasks.php" class="active3">Manage Tasks</a></li>
                    </ul>
                </div>
                <a href="manageResource.php">Resource</a>
                <a href="manageClient.php">Customer</a>
                <a href="feedback.php">Feedback</a>
                <a href="manageIssues.php">Report Issues</a>
            </nav>
            <hr class="section-divider"> 
            <div class="settings"><img src="images/settings.png" alt="Settings">Settings</div>
        </aside>

        <!-- Main Content -->
        <main class="content">
            <div class="calendar-title">Calendar Controls</div>
            <div id="calendar"></div>
        </main>
    </div>

    <script>
        $(document).ready(function() {
            $('#calendar').fullCalendar({
                header: {
                    left: 'prev,next today', //buttons
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay' //view
                },
                defaultView: 'agendaWeek', // Allows date and time selection
                selectable: true, //shows selected time
                selectHelper: true,
                select: function(start, end) {
                    var title = prompt("Enter Event Title:");
                    if (title) {
                        var eventData = {
                            title: title,
                            start: start.format("YYYY-MM-DD HH:mm:ss"),
                            end: end.format("YYYY-MM-DD HH:mm:ss")
                        };
                        $.ajax({
                            url: 'save_event.php',
                            type: 'POST',
                            data: {
                                title: eventData.title,
                                start: eventData.start,
                                end: eventData.end
                            },
                            success: function() {
                                alert("Event added!");
                                $('#calendar').fullCalendar('refetchEvents'); // Refresh events on calendar
                            },
                            error: function() {
                                alert("Could not save event.");
                            }
                        });
                    }
                    $('#calendar').fullCalendar('unselect');
                },
                editable: true, // Allow events to be dragged and resized
                eventDrop: function(event) { // Update event on drag-and-drop
                    $.ajax({
                        url: 'update_event.php',
                        type: 'POST',
                        data: {
                            id: event.id,
                            start: event.start.format("YYYY-MM-DD HH:mm:ss"),
                            end: event.end ? event.end.format("YYYY-MM-DD HH:mm:ss") : null
                        },
                        success: function() {
                            alert("Event updated!");
                        },
                        error: function() {
                            alert("Could not update event.");
                        }
                    });
                },
                eventClick: function(event) { // Delete event on click
                    if (confirm("Do you want to delete this event?")) {
                        $.ajax({
                            url: 'delete_event.php',
                            type: 'POST',
                            data: {
                                id: event.id
                            },
                            success: function() {
                                $('#calendar').fullCalendar('refetchEvents');
                                alert("Event deleted!");
                            },
                            error: function() {
                                alert("Could not delete event.");
                            }
                        });
                    }
                },
                events: 'fetch_events.php' // Load events from the server
            });
        });
    </script>
</body>
</html>
